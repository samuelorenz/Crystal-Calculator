<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crystal Oscillator Validator - Documentazione Tecnica</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <main>
        <h1>Crystal Oscillator Validator: A Technical Reference</h1>
        <p><strong>Versione Software:</strong> 5.0</p>
        <p><strong>Autore:</strong> Samuele Lorenzoni</p>
        <hr>

        <h2>1. Abstract</h2>
        <p>La progettazione di oscillatori a cristallo di quarzo, in particolare nella topologia Pierce, è un'attività critica nell'elettronica digitale. Un design non robusto può causare instabilità di frequenza, mancati avvii o danni permanenti al risuonatore, con conseguenze gravi sull'affidabilità del prodotto finale. Questo documento descrive il <strong>Crystal Oscillator Validator</strong>, un'applicazione software sviluppata per assistere i progettisti nella validazione sistematica e quantitativa di tali circuiti. Lo strumento implementa un modello matematico basato su note applicative standard del settore per calcolare parametri chiave come il <strong>Margine di Guadagno</strong> e il <strong>Drive Level</strong>. Attraverso un'interfaccia grafica interattiva, il software fornisce una valutazione oggettiva del design, evidenziando criticità e aree di miglioramento. Vengono inoltre discusse le funzionalità di gestione di una libreria di componenti e di salvataggio delle sessioni di analisi, che rendono lo strumento un ausilio completo per la progettazione e l'archiviazione della documentazione tecnica.</p>
        <hr>

        <h2>2. Novità della Versione 5.0: Interfaccia "Scientific Paper" e Validazione Chiara</h2>
        <h3>2.1. Estetica "Scientific Paper"</h3>
        <p>L'interfaccia è stata ridisegnata per assomigliare a un'applicazione scientifica o a uno strumento di laboratorio, con un'estetica più pulita, professionale e accademica.</p>
        <ul>
            <li><strong>Caratteri</strong>: L'intera applicazione ora utilizza il font <strong>Times New Roman</strong>, un classico della documentazione tecnica. Le formule matematiche sono rese in <strong>Courier New</strong> per una migliore leggibilità.</li>
            <li><strong>Palette Colori</strong>: È stata adottata una palette di colori neutra, dominata da bianco, nero e grigi, che migliora la concentrazione sui dati. Un <strong>rosso scuro accademico</strong> è usato come colore d'accento per evidenziare le azioni principali e gli avvisi critici, sostituendo i precedenti blu e verdi.</li>
            <li><strong>Stile dei Widget</strong>: Il tema grafico è stato aggiornato per un aspetto più tradizionale e meno invasivo, favorendo la funzionalità rispetto all'estetica decorativa.</li>
        </ul>
        <h3>2.2. Risultato Finale "PASS / FAIL"</h3>
        <p>Per rendere la valutazione del design inequivocabile, è stato introdotto un indicatore di stato finale ben visibile.</p>
        <ul>
            <li><strong>VALIDATION: PASS</strong>: Visualizzato in verde scuro, indica che tutti i parametri calcolati (avvio, margine, drive level) rientrano nei limiti di sicurezza o accettabilità.</li>
            <li><strong>VALIDATION: FAIL</strong>: Visualizzato in rosso scuro, indica che almeno uno dei parametri si trova in uno stato "CRITICO", segnalando che il design non è robusto e richiede modifiche immediate.</li>
        </ul>
        <p>Questo verdetto finale sintetizza l'analisi complessa in una risposta chiara e diretta.</p>
        <hr>

        <h2>3. Installazione</h2>
        <p>Per eseguire il Crystal Oscillator Validator, è necessario avere installato Python 3.</p>
        <ol>
            <li><strong>Clonare o scaricare il repository.</strong></li>
            <li><strong>Creare e attivare un ambiente virtuale (consigliato):</strong>
                <pre><code># Creare l'ambiente
python -m venv .venv

# Attivare su Windows
.venv\Scripts\activate

# Attivare su macOS/Linux
source .venv/bin/activate</code></pre>
            </li>
            <li><strong>Installare la dipendenza necessaria:</strong>
                <p>Una volta attivato l'ambiente virtuale, installare la libreria <code>numpy</code>.</p>
                <pre><code>pip install numpy</code></pre>
            </li>
            <li><strong>Eseguire il programma:</strong>
                <pre><code>python main.py</code></pre>
            </li>
        </ol>
        <hr>

        <h2>4. Contesto Teorico: L'Oscillatore Pierce</h2>
        <p>L'applicazione si focalizza sulla validazione di oscillatori a cristallo basati sulla topologia <strong>Pierce</strong>, la più diffusa in ambito di microcontrollori (MCU) per la sua stabilità, semplicità ed efficienza. Un oscillatore Pierce è costituito da un amplificatore invertente (tipicamente una porta logica CMOS interna all'MCU) e una rete di feedback a π (pi-greco) formata dal cristallo di quarzo e due condensatori di carico esterni (CL1, CL2).</p>
        <ul>
            <li><strong>Il Cristallo come Risuonatore</strong>: Il cristallo di quarzo opera come un elemento risonante ad altissimo fattore di merito (Q). Il suo comportamento elettrico è descritto dal modello di BVD (Butterworth-Van Dyke), che include una capacità statica <code>C0</code> (shunt) e un ramo serie RLC (<code>R1</code>, <code>L1</code>, <code>C1</code>). Ai fini di questo strumento, i parametri fondamentali forniti dal datasheet sono la <strong>Frequenza Nominale (F)</strong>, la <strong>Resistenza Serie Equivalente (ESR o R1)</strong>, la <strong>Capacità di Shunt (C0)</strong> e il <strong>Massimo Drive Level (DL_max)</strong>.</li>
            <li><strong>Condizione di Oscillazione</strong>: Per un'oscillazione stabile, il circuito deve soddisfare il <strong>criterio di Barkhausen</strong>: il guadagno totale di anello deve essere maggiore di 1 e lo sfasamento totale deve essere di 360°. L'amplificatore invertente fornisce 180°, mentre la rete a π deve fornire gli altri 180° e compensare le perdite energetiche introdotte dal cristallo (rappresentate dalla sua ESR).</li>
        </ul>
        <hr>

        <h2>5. Modello Matematico e Implementazione</h2>
        <p>Le analisi eseguite dal software si basano sulle formule e le metodologie descritte in documenti di riferimento come la nota applicativa <strong>AN2867 di STMicroelectronics</strong>. Di seguito vengono dettagliate le formule implementate.</p>
        
        <h3>5.1. Capacità di Carico Effettiva (CL_eff)</h3>
        <ul>
            <li><strong>Formula:</strong><pre><code>C_stray = Cs_PCB + Cs_PIN
CL_eff = (CL_sel + C_stray) / 2</code></pre></li>
            <li><strong>Variabili:</strong>
                <ul>
                    <li><code>CL_sel</code>: Capacità del singolo condensatore di carico esterno (assumendo CL1 = CL2).</li>
                    <li><code>Cs_PCB</code>: Capacità parassita dovuta alle piste del circuito stampato (PCB).</li>
                    <li><code>Cs_PIN</code>: Capacità parassita intrinseca del pin di I/O dell'MCU.</li>
                    <li><code>C_stray</code>: Capacità parassita totale su un singolo ramo dell'oscillatore.</li>
                </ul>
            </li>
            <li><strong>Interpretazione Fisica:</strong> <code>CL_eff</code> rappresenta la capacità totale vista dal cristallo guardando verso la rete di carico. Il suo valore influenza direttamente la frequenza di oscillazione e la stabilità. La formula deriva dalla serie dei due rami capacitivi (ciascuno composto da <code>CL_sel</code> in parallelo con <code>C_stray</code>).</li>
        </ul>

        <h3>5.2. Transconduttanza Critica (Gm_crit)</h3>
        <ul>
            <li><strong>Formula:</strong><pre><code>Total_ESR = ESR_max + Rext_sel
Gm_crit = 4 * Total_ESR * (2 * pi * F)^2 * (C0 + CL_eff)^2</code></pre></li>
            <li><strong>Variabili:</strong>
                <ul>
                    <li><code>ESR_max</code>: Massima Resistenza Serie Equivalente del cristallo (dal datasheet).</li>
                    <li><code>Rext_sel</code>: Valore della resistenza esterna opzionale, usata per limitare il Drive Level.</li>
                    <li><code>F</code>: Frequenza di risonanza nominale del cristallo.</li>
                    <li><code>C0</code>: Capacità di shunt del cristallo (dal datasheet).</li>
                </ul>
            </li>
            <li><strong>Interpretazione Fisica:</strong> <code>Gm_crit</code> è la <strong>transconduttanza minima</strong> che l'amplificatore interno all'MCU deve possedere per innescare e sostenere l'oscillazione. Essa deve essere sufficiente a compensare le perdite introdotte dalla <code>Total_ESR</code> alla frequenza di lavoro. Se la transconduttanza dell'MCU (<code>Gm_MCU</code>) è inferiore a questo valore, l'oscillatore non partirà.</li>
        </ul>

        <h3>5.3. Margine di Guadagno (Gain Margin, S_f)</h3>
        <ul>
            <li><strong>Formula:</strong><pre><code>Gain_Margin = Gm_MCU / Gm_crit</code></pre></li>
            <li><strong>Variabili:</strong>
                <ul>
                    <li><code>Gm_MCU</code>: Transconduttanza dell'amplificatore dell'MCU (dal datasheet del microcontrollore).</li>
                </ul>
            </li>
            <li><strong>Interpretazione Fisica:</strong> Il Margine di Guadagno, noto anche come <em>Safety Factor</em> (S_f), è un indicatore adimensionale della <strong>robustezza dell'oscillatore</strong>. Indica di quanto il guadagno dell'amplificatore supera il minimo necessario. Un margine elevato garantisce un avvio rapido e affidabile in un ampio range di temperature, tensioni di alimentazione e variazioni di processo (sia del cristallo che dell'MCU).</li>
        </ul>

        <h3>5.4. Drive Level (DL)</h3>
        <ul>
            <li><strong>Formula:</strong><pre><code>C_leg_total = CL_sel + C_stray + C_probe
DL = (Total_ESR / 2) * (pi * F * C_leg_total)^2 * Vpp_measured^2</code></pre></li>
            <li><strong>Variabili:</strong>
                <ul>
                    <li><code>C_probe</code>: Capacità della sonda dell'oscilloscopio usata per la misurazione.</li>
                    <li><code>Vpp_measured</code>: Tensione picco-picco misurata sul pin di output dell'oscillatore (solitamente OSC_IN/CL1).</li>
                </ul>
            </li>
            <li><strong>Interpretazione Fisica:</strong> Il Drive Level è la <strong>potenza dissipata dal cristallo</strong> durante l'oscillazione. Un pilotaggio eccessivo (overdrive) può causare un invecchiamento precoce, una deriva in frequenza o un danno fisico permanente al quarzo. Questa formula calcola la potenza basandosi sulla corrente che scorre attraverso il ramo capacitivo misurato. È fondamentale includere <code>C_probe</code>, poiché la sonda altera il comportamento del circuito e la tensione misurata.</li>
        </ul>
        <hr>

        <h2>6. Motore di Validazione: Criteri e Soglie</h2>
        <p>Il software automatizza la valutazione del design confrontando i risultati calcolati con soglie raccomandate dall'industria.</p>
        <ul>
            <li><strong>Criterio 1: Avvio dell'Oscillazione</strong>
                <ul>
                    <li><strong>Controllo</strong>: <code>Gm_MCU > Gm_crit</code></li>
                    <li><strong>Logica</strong>: Se la transconduttanza del dispositivo attivo non supera quella critica, l'oscillazione non può essere sostenuta.</li>
                    <li><strong>Stati</strong>: <code>CRITICO</code> (se <code>Gm_MCU < Gm_crit</code>), <code>OK</code> (se <code>Gm_MCU > Gm_crit</code>).</li>
                </ul>
            </li>
            <li><strong>Criterio 2: Robustezza del Design (Gain Margin)</strong>
                <ul>
                    <li><strong>Controllo</strong>: Valore di <code>Gain_Margin</code>.</li>
                    <li><strong>Logica</strong>: Un margine di guadagno elevato è necessario per compensare le variazioni dei componenti e le derive ambientali.</li>
                    <li><strong>Stati e Soglie</strong>:
                        <ul>
                            <li><code>ECCELLENTE</code> (<code>Gain_Margin ≥ 5</code>): Raccomandato dalla maggior parte dei produttori per design commerciali.</li>
                            <li><code>OTTIMIZZARE</code> (<code>3 ≤ Gain_Margin < 5</code>): Funzionante in condizioni nominali, ma a rischio ai limiti di temperatura/tensione.</li>
                            <li><code>CRITICO</code> (<code>Gain_Margin < 3</code>): Design inaffidabile, con alto rischio di mancato avvio.</li>
                        </ul>
                    </li>
                </ul>
            </li>
            <li><strong>Criterio 3: Affidabilità e Vita Utile (Drive Level)</strong>
                 <ul>
                    <li><strong>Controllo</strong>: Rapporto <code>DL / DL_max</code>.</li>
                    <li><strong>Logica</strong>: Il superamento del <code>DL_max</code> specificato dal produttore del cristallo ne compromette l'integrità.</li>
                    <li><strong>Stati e Soglie</strong>:
                        <ul>
                            <li><code>OK</code> (<code>DL / DL_max ≤ 0.8</code>): Il cristallo opera in un'area di totale sicurezza.</li>
                            <li><code>ATTENZIONE</code> (<code>0.8 < DL / DL_max ≤ 1.0</code>): Il design è al limite. Si raccomanda di considerare una resistenza <code>Rext</code> per ridurre la potenza.</li>
                            <li><code>CRITICO</code> (<code>DL / DL_max > 1.0</code>): Overdrive. Il cristallo è a rischio di danneggiamento. L'uso di <code>Rext</code> è obbligatorio.</li>
                        </ul>
                    </li>
                </ul>
            </li>
        </ul>
        <p>Il software sintetizza questi tre controlli in un <strong>Risultato Finale</strong> univoco, visualizzato in modo prominente nell'interfaccia. Lo stato sarà <code>VALIDATION: PASS</code> se nessun criterio è <code>CRITICO</code>, o <code>VALIDATION: FAIL</code> in caso contrario, fornendo al progettista un verdetto immediato e inequivocabile sulla conformità del design.</p>
        <hr>

        <h2>7. Architettura Software e Funzionalità Avanzate</h2>
        <h3>7.1. Libreria dei Quarzi Dinamica</h3>
        <p>Lo strumento gestisce una libreria di componenti persistente, salvata nel file <code>xtal_library.json</code> nella directory dell'applicazione. Questo file JSON contiene un dizionario di profili di quarzi, dove ogni profilo memorizza i parametri fondamentali (F, C0, ESR, DL_max).</p>
        <ul>
            <li><strong>Gestione</strong>: L'utente può aggiungere nuovi componenti alla libreria (<code>Salva Quarzo</code>), caricarli per un'analisi (<code>&lt;Combobox&gt;</code>) o rimuoverli (<code>Elimina</code>).</li>
            <li><strong>Scopo</strong>: Centralizzare e riutilizzare le specifiche dei componenti approvati o di uso comune, riducendo l'inserimento manuale e gli errori.</li>
        </ul>
        <h3>7.2. Gestione delle Sessioni di Lavoro</h3>
        <p>È fondamentale distinguere la libreria (dati di <em>componenti</em>) dalle sessioni (dati di <em>analisi</em>).</p>
        <ul>
            <li><strong>File di Lavoro (<code>.xtal</code>)</strong>: Tramite <code>File > Salva Lavoro</code>, l'utente può salvare l'intero stato dell'applicazione in un file <code>.xtal</code>. Questo file è un'istantanea JSON che include <strong>tutti i parametri di input</strong>: specifiche del quarzo, parametri del circuito (Gm, CL, parassite) e misurazioni (Vpp, sonda).</li>
            <li><strong>Scopo</strong>: Archiviare una validazione completa per la documentazione di progetto, confrontare diverse configurazioni circuitali per lo stesso quarzo o riprendere un'analisi interrotta.</li>
        </ul>
        <h3>7.3. Interfaccia Utente e Feedback in Tempo Reale</h3>
        <ul>
            <li><strong>Stale Data Invalidation</strong>: Se un qualsiasi parametro di input viene modificato, tutti i risultati calcolati vengono immediatamente invalidati (visualizzati come <code>...</code> in grigio), forzando l'utente a eseguire un nuovo calcolo per garantire la coerenza dei dati.</li>
            <li><strong>Input Validation</strong>: I campi di input numerici sono validati in tempo reale. Un input non valido (es. testo) colora il campo di rosso e impedisce il calcolo, mostrando un errore esplicito.</li>
            <li><strong>Barra di Stato</strong>: Fornisce un log testuale delle azioni eseguite e dello stato corrente, migliorando la consapevolezza dell'utente.</li>
        </ul>
        <hr>

        <h2>8. Protocollo Operativo Consigliato</h2>
        <p>Per una validazione completa e rigorosa, si raccomanda di seguire i seguenti passaggi:</p>
        <ol>
            <li><strong>Raccolta Dati</strong>: Reperire i datasheet del cristallo e dell'MCU. Ottenere i valori di <code>F</code>, <code>C0</code>, <code>ESR_max</code>, <code>DL_max</code> per il cristallo e <code>Gm_MCU</code>, <code>Cs_PIN</code> per l'MCU.</li>
            <li><strong>Stima Parassiti</strong>: Stimare <code>Cs_PCB</code> in base al layout o usare un valore conservativo (es. 1-3 pF).</li>
            <li><strong>Configurazione Iniziale</strong>: Inserire tutti i parametri nello strumento. Selezionare il modello di sonda corretto o inserire la sua capacità manually.</li>
            <li><strong>Misurazione Sperimentale</strong>: Assemblare il circuito e misurare la tensione <code>Vpp</code> sul pin di output dell'oscillatore (es. OSC_IN). Inserire questo valore nel campo <code>Vpp Misurata</code>.</li>
            <li><strong>Esecuzione Calcoli</strong>: Premere il pulsante <code>Esegui Calcoli</code>.</li>
            <li><strong>Analisi dei Risultati</strong>: Valutare criticamente i tre criteri nel pannello "Stato di Validazione" e il risultato finale "PASS/FAIL".</li>
            <li><strong>Iterazione (se necessario)</strong>: Se il risultato è <code>FAIL</code>, modificare il design (es. cambiare i valori di <code>CL_sel</code>, aggiungere/modificare <code>Rext_sel</code>) e ripetere dal punto 4.</li>
            <li><strong>Archiviazione</strong>: Una volta ottenuto un design robusto (<code>PASS</code>), salvare la sessione di lavoro (<code>File > Salva Lavoro</code>) per la documentazione di progetto.</li>
        </ol>
    </main>
</body>
</html>
